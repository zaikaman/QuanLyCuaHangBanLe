@model QuanLyCuaHangBanLe.Models.Promotion

@{
    ViewData["Title"] = "S·ª≠a khuy·∫øn m√£i";
}

<style>
    .form-container {
        max-width: 900px;
        margin: 0 auto;
    }

    .form-card {
        background: white;
        border-radius: 12px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
        padding: 30px;
        border: 1px solid #e5e5e5;
    }

    .form-header {
        margin-bottom: 25px;
        padding-bottom: 15px;
        border-bottom: 2px solid #f5f5f5;
    }

    .form-header h2 {
        font-size: 1.3rem;
        font-weight: 600;
        color: #1a1a1a;
        margin: 0;
    }

    .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-bottom: 20px;
    }

    .form-group {
        margin-bottom: 20px;
    }

    .form-group.full-width {
        grid-column: 1 / -1;
    }

    .form-label {
        display: block;
        margin-bottom: 8px;
        color: #1a1a1a;
        font-weight: 600;
        font-size: 0.9rem;
    }

    .form-control, .form-select {
        width: 100%;
        padding: 10px 14px;
        border: 1px solid #e5e5e5;
        border-radius: 8px;
        font-size: 0.95rem;
        transition: all 0.2s ease;
        background: #fafafa;
    }

    .form-control:focus, .form-select:focus {
        outline: none;
        border-color: #4E5FFF;
        background: white;
        box-shadow: 0 0 0 3px rgba(0, 0, 0, 0.05);
    }

    textarea.form-control {
        min-height: 100px;
        resize: vertical;
    }

    .btn {
        padding: 10px 20px;
        border-radius: 8px;
        font-weight: 600;
        font-size: 0.9rem;
        cursor: pointer;
        transition: all 0.2s ease;
        border: none;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 8px;
    }

    .btn-submit {
        background: #4E5FFF;
        color: white;
        border: 2px solid #4E5FFF;
    }

    .btn-submit:hover {
        background: #ffffff;
        color: #4E5FFF;
        border: 2px solid #4E5FFF;
        box-shadow: 0 4px 12px rgba(78, 95, 255, 0.3);
    }

    .btn-cancel {
        background: #e5e5e5;
        color: #1a1a1a;
    }

    .btn-cancel:hover {
        background: #d4d4d4;
    }

    .form-actions {
        display: flex;
        gap: 15px;
        margin-top: 30px;
        padding-top: 25px;
        border-top: 2px solid #f5f5f5;
    }

    .required {
        color: #dc3545;
        margin-left: 3px;
    }

    .text-danger {
        color: #dc3545;
        font-size: 0.85rem;
        margin-top: 5px;
    }

    .info-badge {
        display: inline-block;
        padding: 4px 8px;
        background: #e3f2fd;
        color: #1976d2;
        border-radius: 4px;
        font-size: 0.8rem;
        margin-left: 8px;
    }

    .info-text {
        font-size: 0.85rem;
        color: #666;
        margin-top: 5px;
    }
</style>

<div class="form-container">
    <div class="form-card">
        <div class="form-header">
            <h2>üìù S·ª≠a khuy·∫øn m√£i</h2>
        </div>

        <form asp-action="Edit" method="post">
            @Html.AntiForgeryToken()
            <input type="hidden" asp-for="PromoId" />
            <input type="hidden" asp-for="UsedCount" />

            <div class="form-row">
                <div class="form-group">
                    <label asp-for="PromoCode" class="form-label">
                        M√£ khuy·∫øn m√£i<span class="required">*</span>
                        <span class="info-badge">VD: SUMMER2024</span>
                    </label>
                    <input asp-for="PromoCode" class="form-control" placeholder="Nh·∫≠p m√£ khuy·∫øn m√£i" required />
                    <span asp-validation-for="PromoCode" class="text-danger"></span>
                </div>

                <div class="form-group">
                    <label asp-for="Status" class="form-label">Tr·∫°ng th√°i</label>
                    <select asp-for="Status" class="form-select">
                        <option value="active">ƒêang ho·∫°t ƒë·ªông</option>
                        <option value="inactive">T·∫°m d·ª´ng</option>
                    </select>
                </div>
            </div>

            <div class="form-group full-width">
                <label asp-for="Description" class="form-label">M√¥ t·∫£</label>
                <textarea asp-for="Description" class="form-control" placeholder="Nh·∫≠p m√¥ t·∫£ v·ªÅ khuy·∫øn m√£i..."></textarea>
                <span asp-validation-for="Description" class="text-danger"></span>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label asp-for="DiscountType" class="form-label">
                        Lo·∫°i gi·∫£m gi√°<span class="required">*</span>
                    </label>
                    <select asp-for="DiscountType" class="form-select" required onchange="updateDiscountLabel()">
                        <option value="">Ch·ªçn lo·∫°i gi·∫£m gi√°</option>
                        <option value="percent">Ph·∫ßn trƒÉm (%)</option>
                        <option value="fixed">S·ªë ti·ªÅn c·ªë ƒë·ªãnh (ƒë)</option>
                    </select>
                    <span asp-validation-for="DiscountType" class="text-danger"></span>
                </div>

                <div class="form-group">
                    <label asp-for="DiscountValue" class="form-label">
                        Gi√° tr·ªã gi·∫£m<span class="required">*</span>
                        <span id="discountUnit" class="info-badge"></span>
                    </label>
                    <input asp-for="DiscountValue" type="number" step="0.01" class="form-control" placeholder="0" required />
                    <span asp-validation-for="DiscountValue" class="text-danger"></span>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label asp-for="StartDate" class="form-label">
                        Ng√†y b·∫Øt ƒë·∫ßu<span class="required">*</span>
                    </label>
                    <input asp-for="StartDate" type="datetime-local" class="form-control" required />
                    <span asp-validation-for="StartDate" class="text-danger"></span>
                </div>

                <div class="form-group">
                    <label asp-for="EndDate" class="form-label">
                        Ng√†y k·∫øt th√∫c<span class="required">*</span>
                    </label>
                    <input asp-for="EndDate" type="datetime-local" class="form-control" required />
                    <span asp-validation-for="EndDate" class="text-danger"></span>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label asp-for="MinOrderAmount" class="form-label">
                        Gi√° tr·ªã ƒë∆°n h√†ng t·ªëi thi·ªÉu (ƒë)
                        <span class="info-badge">0 = kh√¥ng gi·ªõi h·∫°n</span>
                    </label>
                    <input asp-for="MinOrderAmount" type="number" step="1000" class="form-control" />
                    <span asp-validation-for="MinOrderAmount" class="text-danger"></span>
                </div>

                <div class="form-group">
                    <label asp-for="UsageLimit" class="form-label">
                        Gi·ªõi h·∫°n s·ª≠ d·ª•ng
                        <span class="info-badge">0 = kh√¥ng gi·ªõi h·∫°n</span>
                    </label>
                    <input asp-for="UsageLimit" type="number" class="form-control" />
                    <span asp-validation-for="UsageLimit" class="text-danger"></span>
                    <div class="info-text">
                        ƒê√£ s·ª≠ d·ª•ng: @Model.UsedCount l·∫ßn
                    </div>
                </div>
            </div>

            <div class="form-actions">
                <button type="submit" class="btn btn-submit">
                    ‚úÖ L∆∞u thay ƒë·ªïi
                </button>
                <a asp-action="Index" class="btn btn-cancel">
                    ‚ùå H·ªßy b·ªè
                </a>
            </div>
        </form>
    </div>
</div>

<script>
    function updateDiscountLabel() {
        const discountType = document.querySelector('select[name="DiscountType"]').value;
        const unitBadge = document.getElementById('discountUnit');
        
        if (discountType === 'percent') {
            unitBadge.textContent = 'VD: 10 = 10%';
        } else if (discountType === 'fixed') {
            unitBadge.textContent = 'VD: 50000 = 50,000ƒë';
        } else {
            unitBadge.textContent = '';
        }
    }

    // Kh·ªüi t·∫°o
    document.addEventListener('DOMContentLoaded', function() {
        // Format datetime inputs
        const startDate = document.querySelector('input[name="StartDate"]');
        const endDate = document.querySelector('input[name="EndDate"]');
        
        if (startDate && startDate.value) {
            const start = new Date(startDate.value);
            startDate.value = start.toISOString().slice(0, 16);
        }
        
        if (endDate && endDate.value) {
            const end = new Date(endDate.value);
            endDate.value = end.toISOString().slice(0, 16);
        }

        updateDiscountLabel();
    });
</script>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
}
